package com.alex;

import org.junit.jupiter.params.ParameterizedTest;
import org.junit.jupiter.params.provider.MethodSource;

import java.util.List;

import static org.junit.jupiter.api.Assertions.*;

class ScannerTest {
    public static final Token EOF_TOK = new Token(TokenType.EOF, "", null, 1);

    @ParameterizedTest
    @MethodSource("simpleScanTests")
    void testScanTokens(TestCase t) {
        var scanner = new Scanner(t.source);
        var actual = scanner.scanTokens();
        assertIterableEquals(t.expected, actual);
    }

    // Tests generated by Copilot :)
    static List<TestCase> simpleScanTests() {
        return List.of(
                // Single-character tokens
                new TestCase("(", List.of(new Token(TokenType.LEFT_PAREN, "(", null, 1), EOF_TOK)),
                new TestCase(")", List.of(new Token(TokenType.RIGHT_PAREN, ")", null, 1), EOF_TOK)),
                new TestCase("{", List.of(new Token(TokenType.LEFT_BRACE, "{", null, 1), EOF_TOK)),
                new TestCase("}", List.of(new Token(TokenType.RIGHT_BRACE, "}", null, 1), EOF_TOK)),
                new TestCase(",", List.of(new Token(TokenType.COMMA, ",", null, 1), EOF_TOK)),
                new TestCase(".", List.of(new Token(TokenType.DOT, ".", null, 1), EOF_TOK)),
                new TestCase("-", List.of(new Token(TokenType.MINUS, "-", null, 1), EOF_TOK)),
                new TestCase("+", List.of(new Token(TokenType.PLUS, "+", null, 1), EOF_TOK)),
                new TestCase(";", List.of(new Token(TokenType.SEMICOLON, ";", null, 1), EOF_TOK)),
                new TestCase("/", List.of(new Token(TokenType.SLASH, "/", null, 1), EOF_TOK)),
                new TestCase("*", List.of(new Token(TokenType.STAR, "*", null, 1), EOF_TOK)),

                // Multi-character tokens
                new TestCase("!", List.of(new Token(TokenType.BANG, "!", null, 1), EOF_TOK)),
                new TestCase("!=", List.of(new Token(TokenType.BANG_EQUAL, "!=", null, 1), EOF_TOK)),
                new TestCase("=", List.of(new Token(TokenType.EQUAL, "=", null, 1), EOF_TOK)),
                new TestCase("==", List.of(new Token(TokenType.EQUAL_EQUAL, "==", null, 1), EOF_TOK)),
                new TestCase(">", List.of(new Token(TokenType.GREATER, ">", null, 1), EOF_TOK)),
                new TestCase(">=", List.of(new Token(TokenType.GREATER_EQUAL, ">=", null, 1), EOF_TOK)),
                new TestCase("<", List.of(new Token(TokenType.LESS, "<", null, 1), EOF_TOK)),
                new TestCase("<=", List.of(new Token(TokenType.LESS_EQUAL, "<=", null, 1), EOF_TOK)),

                // Identifiers
                new TestCase("identifier", List.of(new Token(TokenType.IDENTIFIER, "identifier", null, 1), EOF_TOK)),

                // String literals
                new TestCase("\"hello\"", List.of(new Token(TokenType.STRING, "\"hello\"", "hello", 1), EOF_TOK)),

                // Number literals
                new TestCase("123", List.of(new Token(TokenType.NUMBER, "123", 123.0, 1), EOF_TOK)),
                new TestCase("123.45", List.of(new Token(TokenType.NUMBER, "123.45", 123.45, 1), EOF_TOK)),

                // Keywords
                new TestCase("and", List.of(new Token(TokenType.AND, "and", null, 1), EOF_TOK)),
                new TestCase("class", List.of(new Token(TokenType.CLASS, "class", null, 1), EOF_TOK)),
                new TestCase("else", List.of(new Token(TokenType.ELSE, "else", null, 1), EOF_TOK)),
                new TestCase("false", List.of(new Token(TokenType.FALSE, "false", null, 1), EOF_TOK)),
                new TestCase("fun", List.of(new Token(TokenType.FUN, "fun", null, 1), EOF_TOK)),
                new TestCase("for", List.of(new Token(TokenType.FOR, "for", null, 1), EOF_TOK)),
                new TestCase("if", List.of(new Token(TokenType.IF, "if", null, 1), EOF_TOK)),
                new TestCase("nil", List.of(new Token(TokenType.NIL, "nil", null, 1), EOF_TOK)),
                new TestCase("or", List.of(new Token(TokenType.OR, "or", null, 1), EOF_TOK)),
                new TestCase("print", List.of(new Token(TokenType.PRINT, "print", null, 1), EOF_TOK)),
                new TestCase("return", List.of(new Token(TokenType.RETURN, "return", null, 1), EOF_TOK)),
                new TestCase("super", List.of(new Token(TokenType.SUPER, "super", null, 1), EOF_TOK)),
                new TestCase("this", List.of(new Token(TokenType.THIS, "this", null, 1), EOF_TOK)),
                new TestCase("true", List.of(new Token(TokenType.TRUE, "true", null, 1), EOF_TOK)),
                new TestCase("var", List.of(new Token(TokenType.VAR, "var", null, 1), EOF_TOK)),
                new TestCase("while", List.of(new Token(TokenType.WHILE, "while", null, 1), EOF_TOK))
        );
    }

     record TestCase(String source, List<Token> expected) { }

}